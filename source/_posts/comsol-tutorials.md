---
title: 使用Comsol进行多体动力学仿真
tags: [Comsol, 多体动力学仿真]
categories: 术业专攻
date: 2021-01-10 15:58:03
---

> 使用 Comsol 进行多体动力学仿真及简单的结果分析。

<!--more-->

## § Comsol仿真操作步骤
### 1 新建模型
打开 **Comsol** $\Rightarrow$ 模型向导 $\Rightarrow$
三维 $\Rightarrow$ **结构力学/多体动力学** $\Rightarrow$
添加+研究 $\Rightarrow$ 瞬态 $\Rightarrow$ 完成。

### 2 建立几何模型
在 **组件1/几何** 中建立几何模型。
复杂的模型需要从外部导入，同时模型可以导出保存。
Comsol 中可以建立简单几何体，下面介绍圆柱和空心圆柱的构建步骤。

#### 2.1 圆柱
1. 单击 **几何** 修改长度单位 `mm` , 角度单位 `rad`。
1. 右键 **几何** 选择`圆柱体`。进入圆柱体设置分栏。
1. 设置**轴类型** ( 即轴的方向 )。 选择`y轴`。
1. **大小和形状**。 半径`40`, 高度`2`。
1. **位置**。`[x,y,z]=[0,2,0]`。
1. 点击**构建所有对象**。在图形界面出现构建的圆盘, 如下图所示。

<img src="https://gitee.com/lazyshawn/piclink/raw/master/comsol/shape_para.png"
height = "250" alt="圆盘参数" align=center />
<img src="https://gitee.com/lazyshawn/piclink/raw/master/comsol/cylinder.png"
height = "250" alt="圆盘" align=center />

#### 2.2 空心圆柱
1. 重复构建圆柱的步骤构建两个圆柱。
**大小和形状** 分别为`[10,2], [4,2]`；
**位置** 均为`[10,0,0]`；
**轴类型** 均为 `y轴`。
1. 构建**差集**。右键 **几何1** ，依次选择 `布尔操作与分割` -- `差集`。
1. 进入**差集** 设置栏。
`要添加的对象` 较大的圆柱，`要减去的对象` 选择较小的圆柱。
1. 点击**构建所有对象**。在图形界面出现构建的圆盘, 如下图所示。

<img src="https://gitee.com/lazyshawn/piclink/raw/master/comsol/cylinder_ring.png"
height = "250" alt="空心圆柱" align=center />


本次仿真实验最终构建的几何模型如下所示：

<img src="https://gitee.com/lazyshawn/piclink/raw/master/comsol/bicylinder.png" 
height = "250" alt="" align=center />

#### 2.3 创建接触对
1. 方法1: 在 **几何1** 下选择 **形成装配**，
**动作** 选为 `装配`，勾选 `创建对`，**对类型** 选择`接触对`。
点击**全部构建**。在**组件1/定义** 下会出现几何模型中重合的面构成的接触对。

1. 方法2: 右键 **组件1/定义** ，依次选择 `对/接触对`。
然后选择 **源边界** 和 **目标边界** 分别为接触的两个面。

**Remark:** 
1. 形成装配会生成接触对。
表示接触表面分别属于两个不同物体，二者接触间不存在剪切力等分子间作用力。
形成联合体生成一致对。
表示接触的几何模型同属于一个实体。

#### 2.4 添加材料
1. 右键 **组件1/材料** ，从库中添加材料，
选择需要的材料，如 `iron`，自动应用到所有域。


### 3 物理场设置
#### 3.1 连接件
连接件是几何实体中连接关节的虚拟部件。
对几何体附加刚性域或其他属性后并不能直接用来定义运动关节，
需要先定义连接件。

1. 右键 **多体动力学** 选择`连接件` 建立连接件1 。选择左圆盘所有表面。
同理建立右圆盘的连接件2。

#### 3.2 定义运动副
双转盘模型可以理解为一边圆盘为转动关节 (铰链关节)，只有一个转动自由度；
另一个圆盘为圆柱副，有一个绕轴线的转动自由度和沿轴线的平动自由度，
其中平动自由度用来控制加持力。

1. 建立 **圆柱副** 。
右键 **多体动力学** 依次选择 `关节/圆柱副`。
选择 **源** 为 `固定`, 目标为 `连接件1`， **关节中心** 选择 `目标质心`。
**关节轴** 选择 `指定方向`，并设置为y轴方向 `[0,1,0]`。

1. 建立 **铰链关节**。
右键 **多体动力学** 依次选择 `关节/铰链关节`。
选择 **源** 为 `固定`, 目标为 `连接件2`， **关节中心** 选择 `目标质心`。
**关节轴** 选择 `指定方向`，并设置为y轴方向 `[0,1,0]`。

1. 为圆柱副设置转速与关节作用力。
右键 **圆柱副1** ，选择 `指定运动`。
**指定旋转运动** 中选择 指定穿越运动为 `角速度`, 设置为 `30rad/s`。
右键 **圆柱副1** ，选择 `作用力和力矩`。
**作用于** `目标连接件`， **位置** 为`连接件中心`，
设置作用力为`[0,1,0] N`。

1. 为铰链关节设置转速。
右键 **铰链关节1** ，选择 `指定运动`。
**指定旋转运动** 中选择 指定穿越运动为 `角速度`, 设置为 `-30rad/s`。

#### 3.3 物理场中的接触对
物理场中的接触对用于模拟实际物体之间接触发生的动力学模型，
没有添加接触对的实体在仿真中不会发生碰撞和干涉。
圆盘和物体之间的正压力和摩擦力等需要通过设置接触对来实现，
设置步骤如下。

1. 右键 **多体动力学** 选择`对/摩擦` 以添加接触对。

1. 进入 **接触** 设置界面，**对选择** 选择几何模型中设置的`接触对1`。

1. 添加摩擦特征，右键 **接触1** 选择 `摩擦`。
进入摩擦设置界面，设置摩擦模型。

1. 重复上述操作，建立并设置 `接触2`。

本实验的摩擦参数选择为：

<img src="https://gitee.com/lazyshawn/piclink/raw/master/comsol/friction.png"
height = "250" alt="摩擦参数" align=center />


#### 3.4 添加力场
为被控物体添加重力。

1. 右键 **多体动力学** 选择 `体积力/重力`。
在重力设置界面，**域选择** 选择为被控物体。


#### 3.5 划分网格
选择自动划分网格。
在 **多提动力学/网格1** 中选择物理场控制网格，并选择单元大小。
点击全部构建即可，`超细化` 网格生成后如下图所示。

<img src="https://gitee.com/lazyshawn/piclink/raw/master/comsol/meshing.png"
height = "250" alt="划分网格" align=center />

**Remark:** 
1. 运行的结果可能会影响之后修改后的模型的仿真 (不确定)。
如果仿真报错，而模型设置没有问题时可以考虑创建新的仿真文件。

1. 添加物理时，最好每添加一个运行一次仿真，以确保设置无误。


### 4 模型的仿真及结果分析
#### 4.1 模型仿真
1. 展开 **研究1/步骤1: 瞬态**，设置仿真器时间步。
1. 点击 **瞬态** 设置栏中的计算，开始仿真。

本次实验的时间步设置如下，实验平均用时25mins。

<img src="https://gitee.com/lazyshawn/piclink/raw/master/comsol/solver_setting.png"
height = "250" alt="仿真器设置" align=center />


#### 4.2 仿真效果的查看
仿真结束后, 在结果栏中出现新的子菜单, 如图所示。
在 **位移** 和 **速度** 栏中可以查看每个时间步下的物理场和速度场。
位移场也展示在下面。

<img src="https://gitee.com/lazyshawn/piclink/raw/master/comsol/result_menu.png"
height = "250" alt="结果菜单" align=center />
<img src="https://gitee.com/lazyshawn/piclink/raw/master/comsol/motion.png" 
height = "250" alt="位移场" align=center />


#### 4.3 导出动画
以导出位移场的动画为例。

1. 选择 **结果/位移(mbd)**，菜单栏中出现新的操作按钮(如下图)。
右下角的按钮即为 **动画**。

1. 点击 **动画/文件** 。
**输出类型** 选择 `电影` ，**格式** 选择 `GIF` ，
**时间选择** 选择 `来自列表` 后可以导出特定时间段的视频，也可以后期剪辑，
**布局** 选项中勾选需要导出的额外信息。

1. 点击导出，选择保存路径和文件名即可。

<img src="https://gitee.com/lazyshawn/piclink/raw/master/comsol/animation.png"
width = "450" alt="制作动画" align=center />


#### 4.4 导出指定点的物理信息
1. 右键 **结果/派生值** 选择 `点计算`。
进入点计算设置栏，手动选择需要计算的点，
这里可选择的点根据模型的变化而有所不同。
**表达式** 添加需要导出的变量名称 
(具体的查找方法待定, 可查看帮助手册$^{[1]}$)，
`x, y, z, u, v, w` 分别为各个方向的位置和速度。
点击 **计算**, 会在消息栏 (界面右下角) 出现计算结果，
并生成 **结果/表格/表格1** 。

1. 进入 **结果/表格/表格1** 选择 `添加要导出的表` 。

1. 右键 **结果/导出/表格1** 导出, 选择保存路径和文件名即可。


### Reference
1. [Comsol Multiphysics 后处理与可视化综述](
http://cdn.comsol.com/translated-documentation/cn/5.0/%E5%90%8E%E5%A4%84%E7%90%86%E4%B8%8E%E5%8F%AF%E8%A7%86%E5%8C%96%E7%BB%BC%E8%BF%B0.pdf)



